{% extends 'parlour/base_b.html' %}

{% block title %}Manage Products - Hoka's Parlour{% endblock %}

{% block page_icon %}fas fa-tshirt{% endblock %}
{% block page_title %}Manage Products{% endblock %}
{% block page_subtitle %}View and manage all products in your store{% endblock %}

{% block extra_style %}
<style>
    /* Products Stats Cards */
    .products-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-mini-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: var(--transition);
    }

    .stat-mini-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
        border-color: var(--accent-light);
    }

    .stat-mini-icon {
        width: 48px;
        height: 48px;
        background: var(--accent-soft);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--accent);
        font-size: 1.3rem;
    }

    .stat-mini-content h4 {
        font-size: 0.85rem;
        color: var(--text-soft);
        margin-bottom: 4px;
    }

    .stat-mini-content .value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text);
        line-height: 1.2;
    }

    /* Filters */
    .products-filters {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 1.25rem;
        margin-bottom: 2rem;
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: center;
        justify-content: space-between;
    }

    .filter-group {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        align-items: center;
    }

    .filter-select {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 0.6rem 2rem 0.6rem 1rem;
        color: var(--text);
        font-size: 0.9rem;
        cursor: pointer;
        outline: none;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%237b2eda' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.7rem center;
        background-size: 16px;
    }

    .filter-select:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .search-input-wrapper {
        position: relative;
        min-width: 280px;
    }

    .search-input-wrapper i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-soft);
        font-size: 0.9rem;
    }

    .search-input-wrapper input {
        width: 100%;
        padding: 0.6rem 1rem 0.6rem 2.5rem;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: var(--surface);
        color: var(--text);
        font-size: 0.9rem;
        transition: var(--transition);
    }

    .search-input-wrapper input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .btn-primary {
        background: var(--accent);
        color: white;
        border: none;
        padding: 0.6rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-primary:hover {
        background: var(--accent-light);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    /* Products Table */
    .products-table {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
    }

    .products-table table {
        width: 100%;
        border-collapse: collapse;
    }

    .products-table th {
        background: var(--surface);
        padding: 1rem 1.5rem;
        text-align: left;
        font-weight: 600;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-soft);
        border-bottom: 1px solid var(--border);
    }

    .products-table td {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--border);
        color: var(--text);
        font-size: 0.95rem;
        vertical-align: middle;
    }

    .products-table tbody tr {
        transition: var(--transition);
    }

    .products-table tbody tr:hover {
        background: var(--accent-soft);
    }

    .product-image-wrapper {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        overflow: hidden;
        background: var(--surface);
        border: 1px solid var(--border);
    }

    .product-image-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .product-name {
        font-weight: 600;
        color: var(--text);
        margin-bottom: 4px;
    }

    .category-badge {
        background: var(--accent-soft);
        color: var(--accent);
        padding: 0.4rem 1rem;
        border-radius: 50px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-block;
    }

    .price-display {
        font-weight: 700;
        color: var(--text);
        font-size: 1.1rem;
    }

    /* Status Badges using the admin base colors */
    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.4rem 1rem;
        border-radius: 50px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .status-badge i {
        margin-right: 4px;
        font-size: 0.7rem;
    }

    .status-badge.success {
        background: var(--success-soft);
        color: var(--success);
    }

    .status-badge.warning {
        background: var(--warning-soft);
        color: var(--warning);
    }

    .status-badge.danger {
        background: var(--danger-soft);
        color: var(--danger);
    }

    .status-badge.info {
        background: var(--info-soft);
        color: var(--info);
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .action-btn {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: var(--surface);
        color: var(--text-soft);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
        text-decoration: none;
    }

    .action-btn:hover {
        background: var(--accent-soft);
        color: var(--accent);
        border-color: var(--accent);
    }

    .action-btn.delete:hover {
        background: var(--danger-soft);
        color: var(--danger);
        border-color: var(--danger);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 24px;
        margin-top: 2rem;
    }

    .empty-state i {
        font-size: 4rem;
        color: var(--accent-light);
        margin-bottom: 1rem;
    }

    .empty-state h3 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text);
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: var(--text-soft);
        margin-bottom: 2rem;
    }

    /* Bulk Actions Bar */
    .bulk-actions-bar {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 1rem 1.5rem;
        margin-top: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .selected-count {
        color: var(--text-soft);
        font-size: 0.9rem;
    }

    .selected-count span {
        color: var(--accent);
        font-weight: 600;
    }

    .btn-secondary {
        background: var(--surface);
        color: var(--text);
        border: 1px solid var(--border);
        padding: 0.6rem 1.5rem;
        border-radius: 12px;
        font-weight: 500;
        font-size: 0.9rem;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-secondary:hover:not(:disabled) {
        border-color: var(--accent);
        color: var(--accent);
        background: var(--accent-soft);
    }

    .btn-secondary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Pagination */
    .pagination {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .page-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border: 1px solid var(--border);
        border-radius: 10px;
        color: var(--text);
        text-decoration: none;
        transition: var(--transition);
        background: var(--card);
    }

    .page-link:hover {
        border-color: var(--accent);
        background: var(--accent-soft);
        color: var(--accent);
    }

    .page-item.active .page-link {
        background: var(--accent);
        border-color: var(--accent);
        color: white;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .products-filters {
            flex-direction: column;
            align-items: stretch;
        }
        
        .filter-group {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-input-wrapper {
            min-width: auto;
        }
        
        .products-table {
            overflow-x: auto;
            display: block;
        }
        
        .products-table table {
            min-width: 900px;
        }
        
        .bulk-actions-bar {
            flex-direction: column;
            align-items: stretch;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Quick Stats -->
<div class="products-stats">
    <div class="stat-mini-card">
        <div class="stat-mini-icon">
            <i class="fas fa-box"></i>
        </div>
        <div class="stat-mini-content">
            <h4>Total Products</h4>
            <div class="value">{{ products|length }}</div>
        </div>
    </div>
    <div class="stat-mini-card">
        <div class="stat-mini-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-mini-content">
            <h4>Low Stock</h4>
            <div class="value">
                {% with low_stock=products|dictsortreversed:"stock_quantity" %}
                    {{ products|length }}
                {% endwith %}
            </div>
        </div>
    </div>
    <div class="stat-mini-card">
        <div class="stat-mini-icon">
            <i class="fas fa-ban"></i>
        </div>
        <div class="stat-mini-content">
            <h4>Out of Stock</h4>
            <div class="value">0</div>
        </div>
    </div>
    <div class="stat-mini-card">
        <div class="stat-mini-icon">
            <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-mini-content">
            <h4>Inventory Value</h4>
            <div class="value">KSH 0</div>
        </div>
    </div>
</div>

<!-- Filters and Actions -->
<div class="products-filters">
    <div class="filter-group">
        <select class="filter-select">
            <option value="">All Categories</option>
            {% for value, label in categories %}
                <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>
        
        <select class="filter-select">
            <option value="">All Stock Status</option>
            <option value="in_stock">In Stock</option>
            <option value="low_stock">Low Stock</option>
            <option value="out_of_stock">Out of Stock</option>
        </select>
    </div>
    
    <div class="filter-group">
        <div class="search-input-wrapper">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search products...">
        </div>
        
        <a href="{% url 'add_product' %}" class="btn-primary">
            <i class="fas fa-plus"></i> Add Product
        </a>
    </div>
</div>

{% if products %}
<!-- Products Table -->
<div class="products-table">
    <table>
        <thead>
            <tr>
                <th width="50">
                    <input type="checkbox" style="accent-color: var(--accent);">
                </th>
                <th>Product</th>
                <th>Category</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>
                    <input type="checkbox" style="accent-color: var(--accent);">
                </td>
                <td>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="product-image-wrapper">
                            {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}">
                            {% else %}
                                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: var(--surface); color: var(--text-soft);">
                                    <i class="fas fa-image"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div>
                            <div class="product-name">{{ product.name }}</div>
                            <small style="color: var(--text-soft);">ID: #{{ product.id }}</small>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="category-badge">{{ product.get_category_display }}</span>
                </td>
                <td>
                    <span class="price-display">KSH {{ product.price|floatformat:0 }}</span>
                </td>
                <td>{{ product.stock_quantity }} units</td>
                <td>
                    {% if product.stock_quantity > 10 %}
                        <span class="status-badge success">
                            <i class="fas fa-check-circle"></i> In Stock
                        </span>
                    {% elif product.stock_quantity > 0 %}
                        <span class="status-badge warning">
                            <i class="fas fa-exclamation-circle"></i> Low Stock
                        </span>
                    {% else %}
                        <span class="status-badge danger">
                            <i class="fas fa-times-circle"></i> Out of Stock
                        </span>
                    {% endif %}
                </td>
                <td>
                    <div class="action-buttons">
                        <a href="{% url 'edit_product' product.id %}" class="action-btn" title="Edit">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'product_detail' product.id %}" class="action-btn" title="View">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{% url 'delete_product' product.id %}" class="action-btn delete" title="Delete" onclick="return confirm('Are you sure?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Bulk Actions -->
<div class="bulk-actions-bar">
    <div class="selected-count">
        <span id="selectedCount">0</span> product(s) selected
    </div>
    <div style="display: flex; gap: 0.75rem;">
        <button class="btn-secondary" id="bulkEdit" disabled>
            <i class="fas fa-edit"></i> Edit
        </button>
        <button class="btn-secondary" id="bulkDelete" disabled onclick="return confirm('Delete selected products?')">
            <i class="fas fa-trash"></i> Delete
        </button>
    </div>
</div>

{% else %}
<!-- Empty State -->
<div class="empty-state">
    <i class="fas fa-box-open"></i>
    <h3>No Products Yet</h3>
    <p>Get started by adding your first product to the store</p>
    <a href="{% url 'add_product' %}" class="btn-primary">
        <i class="fas fa-plus"></i> Add Your First Product
    </a>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Select All functionality
    const selectAll = document.querySelector('thead input[type="checkbox"]');
    const productChecks = document.querySelectorAll('tbody input[type="checkbox"]');
    const selectedCountSpan = document.getElementById('selectedCount');
    const bulkEdit = document.getElementById('bulkEdit');
    const bulkDelete = document.getElementById('bulkDelete');
    
    function updateSelectedCount() {
        const checked = document.querySelectorAll('tbody input[type="checkbox"]:checked');
        const count = checked.length;
        if (selectedCountSpan) {
            selectedCountSpan.textContent = count;
        }
        
        // Enable/disable bulk buttons
        if (bulkEdit) bulkEdit.disabled = count === 0;
        if (bulkDelete) bulkDelete.disabled = count === 0;
    }
    
    if (selectAll) {
        selectAll.addEventListener('change', function() {
            productChecks.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
            updateSelectedCount();
        });
    }
    
    productChecks.forEach(checkbox => {
        checkbox.addEventListener('change', updateSelectedCount);
    });
});
</script>
{% endblock %}
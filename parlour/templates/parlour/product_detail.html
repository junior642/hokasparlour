{% extends 'parlour/base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Hoka's Parlour{% endblock %}

{% block extra_style %}
<style>
/* ===== MODERN PRODUCT DETAIL – LUXURY PURPLE THEME ===== */
:root {
    --primary: #8B3DFF;
    --primary-dark: #6B1FCC;
    --primary-light: #B48AFF;
    --primary-soft: rgba(139, 61, 255, 0.08);
    --primary-gradient: linear-gradient(135deg, #8B3DFF, #6B1FCC);
    --accent: #FF6B9D;
    --text-primary: #1A1F36;
    --text-secondary: #6B7280;
    --bg-primary: #FFFFFF;
    --bg-secondary: #F9FAFF;
    --border-light: #E9EAF0;
    --border-focus: #8B3DFF;
    --shadow-sm: 0 4px 12px rgba(139, 61, 255, 0.08);
    --shadow-md: 0 8px 24px rgba(139, 61, 255, 0.12);
    --shadow-lg: 0 20px 40px -12px rgba(139, 61, 255, 0.25);
    --shadow-hover: 0 30px 50px -15px rgba(139, 61, 255, 0.35);
    --radius-sm: 16px;
    --radius-md: 24px;
    --radius-lg: 32px;
    --transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.dark-mode {
    --text-primary: #F9FAFF;
    --text-secondary: #B0B7C3;
    --bg-primary: #13141B;
    --bg-secondary: #1E1F2C;
    --border-light: #2A2D3A;
}

/* ===== MAIN CONTAINER ===== */
.product-detail-wrapper {
    max-width: 1440px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
    animation: fadeSlideUp 0.6s ease;
}

@keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ===== PRODUCT GRID LAYOUT ===== */
.product-detail-container {
    display: grid;
    grid-template-columns: 1.1fr 0.9fr;
    gap: 2.5rem;
    background: var(--bg-primary);
    border-radius: var(--radius-lg);
    padding: 2rem;
    border: 1px solid var(--border-light);
    box-shadow: var(--shadow-md);
}

/* ===== IMAGE GALLERY - MODERN & ELEGANT ===== */
.product-image-section {
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    padding: 1.5rem;
}

.image-gallery {
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
}

.main-image-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 1;
    border-radius: var(--radius-md);
    overflow: hidden;
    background: var(--bg-primary);
    border: 2px solid var(--border-light);
    cursor: zoom-in;
}

.main-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.main-image-wrapper:hover .main-image {
    transform: scale(1.08);
}

/* Zoom indicator */
.zoom-indicator {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    background: rgba(0, 0, 0, 0.5);
    color: white;
    padding: 0.5rem;
    border-radius: 50%;
    font-size: 0.8rem;
    backdrop-filter: blur(4px);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.main-image-wrapper:hover .zoom-indicator {
    opacity: 1;
}

/* Thumbnail Gallery */
.thumbnail-gallery {
    display: flex;
    gap: 0.8rem;
    overflow-x: auto;
    padding: 0.5rem 0;
    scrollbar-width: thin;
    scrollbar-color: var(--primary) var(--border-light);
}

.thumbnail-gallery::-webkit-scrollbar {
    height: 4px;
}

.thumbnail-gallery::-webkit-scrollbar-track {
    background: var(--border-light);
    border-radius: 10px;
}

.thumbnail-gallery::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 10px;
}

.thumbnail-item {
    flex: 0 0 80px;
    aspect-ratio: 1;
    border-radius: var(--radius-sm);
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: var(--transition);
    opacity: 0.6;
    background: var(--bg-primary);
}

.thumbnail-item.active {
    border-color: var(--primary);
    opacity: 1;
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
}

.thumbnail-item:hover {
    opacity: 1;
    transform: translateY(-2px);
}

.thumbnail-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Image placeholder */
.image-placeholder {
    width: 100%;
    aspect-ratio: 1;
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    color: var(--text-secondary);
    border-radius: var(--radius-md);
    border: 2px dashed var(--border-light);
}

.image-placeholder i {
    font-size: 3rem;
    color: var(--primary-light);
}

/* ===== PRODUCT INFORMATION ===== */
.product-info-section {
    display: flex;
    flex-direction: column;
}

/* Breadcrumb */
.breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    color: var(--text-secondary);
    font-size: 0.9rem;
    flex-wrap: wrap;
}

.breadcrumb a {
    color: var(--text-secondary);
    text-decoration: none;
    transition: color 0.3s ease;
}

.breadcrumb a:hover {
    color: var(--primary);
}

.breadcrumb i {
    font-size: 0.7rem;
}

/* Product Title */
.product-title {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 1rem;
    font-family: 'Playfair Display', serif;
    line-height: 1.2;
}

/* Product Meta */
.product-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.category-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--primary-soft);
    color: var(--primary);
    padding: 0.5rem 1.2rem;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 600;
    border: 1px solid var(--primary-light);
}

.product-sku {
    color: var(--text-secondary);
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Rating */
.product-rating {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    margin-bottom: 1.5rem;
}

.stars {
    display: flex;
    gap: 0.2rem;
    color: #FFB800;
}

.rating-count {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Description */
.product-description {
    color: var(--text-secondary);
    line-height: 1.8;
    margin-bottom: 2rem;
    font-size: 1rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border-light);
}

/* Price Card */
.price-card {
    background: var(--primary-soft);
    border-radius: var(--radius-md);
    padding: 1.8rem;
    margin-bottom: 1.8rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border: 1px solid var(--primary-light);
}

.price-label {
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 500;
}

.price-value {
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: flex-end;
}

.current-price {
    font-size: 3rem;
    font-weight: 800;
    color: var(--primary);
    line-height: 1;
}

.original-price {
    font-size: 1.2rem;
    color: var(--text-secondary);
    text-decoration: line-through;
}

.discount-badge {
    background: var(--accent);
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 600;
}

/* Stock Status */
.stock-status {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.2rem 1.5rem;
    background: var(--bg-secondary);
    border-radius: var(--radius-sm);
    margin-bottom: 1.8rem;
}

.stock-status.in-stock {
    border-left: 4px solid #10B981;
}

.stock-status.low-stock {
    border-left: 4px solid #F59E0B;
}

.stock-status.out-of-stock {
    border-left: 4px solid #EF4444;
}

.stock-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.in-stock .stock-icon {
    background: rgba(16, 185, 129, 0.1);
    color: #10B981;
}

.low-stock .stock-icon {
    background: rgba(245, 158, 11, 0.1);
    color: #F59E0B;
}

.out-of-stock .stock-icon {
    background: rgba(239, 68, 68, 0.1);
    color: #EF4444;
}

.stock-details h4 {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.2rem;
}

.stock-details p {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Product Form */
.product-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-top: 0.5rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
}

.form-label {
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-label i {
    color: var(--primary);
}

.form-control {
    width: 100%;
    padding: 1rem 1.2rem;
    border: 2px solid var(--border-light);
    border-radius: var(--radius-sm);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 1rem;
    transition: var(--transition);
    outline: none;
}

.form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px var(--primary-soft);
}

select.form-control {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%238B3DFF' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1rem;
}

/* Quantity Selector */
.quantity-selector {
    display: flex;
    align-items: center;
    border: 2px solid var(--border-light);
    border-radius: var(--radius-sm);
    overflow: hidden;
}

.quantity-btn {
    width: 48px;
    height: 48px;
    background: var(--bg-secondary);
    border: none;
    color: var(--text-primary);
    font-size: 1.2rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
}

.quantity-btn:hover {
    background: var(--primary);
    color: white;
}

.quantity-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.quantity-input {
    width: 80px;
    height: 48px;
    border: none;
    border-left: 2px solid var(--border-light);
    border-right: 2px solid var(--border-light);
    text-align: center;
    font-weight: 600;
    font-size: 1rem;
    background: var(--bg-primary);
    color: var(--text-primary);
}

/* Add to Cart Button */
.add-to-cart-btn {
    width: 100%;
    padding: 1.2rem;
    background: var(--primary-gradient);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    position: relative;
    overflow: hidden;
}

.add-to-cart-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.add-to-cart-btn:hover::before {
    width: 300px;
    height: 300px;
}

.add-to-cart-btn:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-hover);
}

.add-to-cart-btn:active {
    transform: translateY(0);
}

.add-to-cart-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

/* Action Buttons Group */
.action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
}

.action-btn {
    flex: 1;
    padding: 1rem;
    background: var(--bg-secondary);
    border: 2px solid var(--border-light);
    border-radius: var(--radius-sm);
    color: var(--text-primary);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.action-btn:hover {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    transform: translateY(-2px);
}

/* Delivery Info */
.delivery-info {
    margin-top: 2rem;
    padding: 1.5rem;
    background: var(--bg-secondary);
    border-radius: var(--radius-sm);
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
}

.delivery-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 0.5rem;
}

.delivery-item i {
    font-size: 1.5rem;
    color: var(--primary);
}

.delivery-item span {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
}

.delivery-item small {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

/* Back Link */
.back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.8rem;
    margin-top: 2rem;
    padding: 0.8rem 1.5rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-light);
    border-radius: 50px;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 1rem;
    font-weight: 500;
    transition: var(--transition);
    width: fit-content;
}

.back-link:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    transform: translateX(-5px);
}

/* ===== ADDITIONAL INFO TABS ===== */
.product-tabs {
    margin-top: 3rem;
    background: var(--bg-primary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-light);
    overflow: hidden;
}

.tab-headers {
    display: flex;
    border-bottom: 1px solid var(--border-light);
    background: var(--bg-secondary);
    flex-wrap: wrap;
}

.tab-header {
    padding: 1.2rem 2rem;
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition);
    border-bottom: 3px solid transparent;
}

.tab-header.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
    background: var(--bg-primary);
}

.tab-content {
    padding: 2rem;
    color: var(--text-secondary);
    line-height: 1.8;
}

.tab-content ul {
    margin-left: 1.5rem;
    margin-top: 0.5rem;
}

.tab-content li {
    margin-bottom: 0.5rem;
}

/* ===== RECOMMENDATIONS ===== */
.recommendations-section {
    margin-top: 4rem;
}

.section-header {
    text-align: center;
    margin-bottom: 2.5rem;
}

.section-header h3 {
    font-size: 2.2rem;
    font-weight: 700;
    color: var(--text-primary);
    font-family: 'Playfair Display', serif;
    margin-bottom: 0.5rem;
}

.section-header p {
    color: var(--text-secondary);
    font-size: 1.1rem;
}

.recommendations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 2rem;
}

.recommendation-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    padding: 1.2rem;
    transition: var(--transition);
    text-decoration: none;
    color: inherit;
    display: block;
    position: relative;
    overflow: hidden;
}

.recommendation-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary-gradient);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.recommendation-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary);
}

.recommendation-card:hover::before {
    transform: scaleX(1);
}

.recommendation-image {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
    border-radius: var(--radius-sm);
    margin-bottom: 1rem;
    background: var(--bg-secondary);
}

.recommendation-image-placeholder {
    width: 100%;
    aspect-ratio: 1;
    background: var(--bg-secondary);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    font-size: 2rem;
    margin-bottom: 1rem;
}

.recommendation-card h4 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.recommendation-price {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 0.5rem;
}

.recommendation-stock {
    font-size: 0.85rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.recommendation-stock i {
    color: #10B981;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 1200px) {
    .product-detail-container {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .product-title {
        font-size: 2.2rem;
    }
    
    .current-price {
        font-size: 2.5rem;
    }
}

@media (max-width: 768px) {
    .product-detail-wrapper {
        padding: 1rem;
    }
    
    .product-detail-container {
        padding: 1.5rem;
    }
    
    .product-title {
        font-size: 1.8rem;
    }
    
    .form-row {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .delivery-info {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .tab-header {
        padding: 1rem 1.2rem;
        font-size: 0.9rem;
    }
    
    .recommendations-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    
    .back-link {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .product-title {
        font-size: 1.5rem;
    }
    
    .product-meta {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .current-price {
        font-size: 2rem;
    }
    
    .price-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .price-value {
        width: 100%;
        justify-content: space-between;
    }
    
    .thumbnail-gallery {
        justify-content: center;
    }
    
    .thumbnail-item {
        flex: 0 0 60px;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .recommendations-grid {
        grid-template-columns: 1fr;
    }
    
    .section-header h3 {
        font-size: 1.8rem;
    }
}

/* ===== ANIMATIONS ===== */
@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.pulse {
    animation: pulse 2s infinite;
}

/* Loading Spinner */
.spinner {
    width: 20px;
    height: 20px;
    border: 3px solid var(--border-light);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    display: inline-block;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Toast Notification */
.toast-notification {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: var(--bg-primary);
    border-left: 4px solid #10B981;
    border-radius: var(--radius-sm);
    padding: 1rem 1.5rem;
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: center;
    gap: 1rem;
    z-index: 1000;
    animation: slideInRight 0.3s ease;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

.toast-icon {
    color: #10B981;
    font-size: 1.5rem;
}

.toast-message {
    color: var(--text-primary);
    font-weight: 500;
}
</style>
{% endblock %}

{% block content %}
<div class="product-detail-wrapper">
    <!-- PRODUCT DETAIL GRID -->
    <div class="product-detail-container">
        <!-- IMAGE GALLERY SECTION -->
        <div class="product-image-section">
            {% if all_images %}
                <div class="image-gallery">
                    <div class="main-image-wrapper" id="mainImageWrapper" onclick="openZoomModal()">
                        <img src="{{ all_images.0.url }}" alt="{{ product.name }}" class="main-image" id="mainImage">
                        <div class="zoom-indicator">
                            <i class="fas fa-search-plus"></i>
                        </div>
                    </div>
                    
                    {% if all_images|length > 1 %}
                        <div class="thumbnail-gallery">
                            {% for img in all_images %}
                                <div class="thumbnail-item {% if forloop.first %}active{% endif %}" 
                                     onclick="changeImage('{{ img.url }}', this)">
                                    <img src="{{ img.url }}" alt="{{ img.alt_text|default:product.name }}">
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <div class="image-placeholder">
                    <i class="fas fa-image"></i>
                    <span>No Image Available</span>
                </div>
            {% endif %}
        </div>
        
        <!-- PRODUCT INFO SECTION -->
        <div class="product-info-section">
            <!-- Breadcrumb (fixed - removed category URL that doesn't exist) -->
            <div class="breadcrumb">
                <a href="{% url 'home' %}">Home</a>
                <i class="fas fa-chevron-right"></i>
                <span>{{ product.get_category_display }}</span>
                <i class="fas fa-chevron-right"></i>
                <span>{{ product.name|truncatechars:30 }}</span>
            </div>
            
            <h1 class="product-title">{{ product.name }}</h1>
            
            <div class="product-meta">
                <span class="category-badge">
                    <i class="fas fa-{% if product.category == 'men' %}male{% elif product.category == 'women' %}female{% else %}tshirt{% endif %}"></i>
                    {{ product.get_category_display }}
                </span>
                {% if product.sku %}
                    <span class="product-sku">
                        <i class="fas fa-barcode"></i> SKU: {{ product.sku }}
                    </span>
                {% endif %}
            </div>
            
            <!-- Rating (Static for now - can be dynamic later) -->
            <div class="product-rating">
                <div class="stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                </div>
                <span class="rating-count">(24 reviews)</span>
            </div>
            
            <p class="product-description">{{ product.description }}</p>
            
            <!-- Price Card -->
            <div class="price-card">
                <span class="price-label">Price</span>
                <div class="price-value">
                    <span class="current-price">KSh {{ product.price|floatformat:0 }}</span>
                    {% if product.old_price %}
                        <span class="original-price">KSh {{ product.old_price|floatformat:0 }}</span>
                        <span class="discount-badge">
                            -{{ product.discount_percentage }}%
                        </span>
                    {% endif %}
                    <small>KES</small>
                </div>
            </div>
            
            <!-- Stock Status -->
            {% if product.is_in_stock %}
                <div class="stock-status {% if product.stock_quantity <= 5 %}low-stock{% else %}in-stock{% endif %}">
                    <div class="stock-icon">
                        <i class="fas {% if product.stock_quantity <= 5 %}fa-exclamation{% else %}fa-check{% endif %}"></i>
                    </div>
                    <div class="stock-details">
                        <h4>{% if product.stock_quantity <= 5 %}Low Stock{% else %}In Stock{% endif %}</h4>
                        <p>{{ product.stock_quantity }} units available • Ready to ship</p>
                    </div>
                </div>
                
                <!-- Add to Cart Form -->
                <form method="post" action="{% url 'add_to_cart' product.id %}" class="product-form" id="addToCartForm">
                    {% csrf_token %}
                    
                    <div class="form-row">
                        {% if sizes %}
                        <div class="form-group">
                            <label class="form-label" for="size">
                                <i class="fas fa-ruler"></i> Size
                            </label>
                            <select name="size" id="size" class="form-control" required>
                                <option value="" disabled selected>Select size</option>
                                {% for size in sizes %}
                                    <option value="{{ size }}">{{ size }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                        
                        <div class="form-group">
                            <label class="form-label" for="quantity">
                                <i class="fas fa-shopping-bag"></i> Quantity
                            </label>
                            <div class="quantity-selector">
                                <button type="button" class="quantity-btn" onclick="decrementQuantity()">−</button>
                                <input type="number" name="quantity" id="quantity" value="1" 
                                       min="1" max="{{ product.stock_quantity }}" class="quantity-input" readonly>
                                <button type="button" class="quantity-btn" onclick="incrementQuantity({{ product.stock_quantity }})">+</button>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="add-to-cart-btn" id="addToCartBtn">
                        <i class="fas fa-cart-plus"></i>
                        Add to Cart
                    </button>
                </form>
                
                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="action-btn" onclick="addToWishlist({{ product.id }})">
                        <i class="far fa-heart"></i> Wishlist
                    </button>
                    <button class="action-btn" onclick="shareProduct()">
                        <i class="fas fa-share-alt"></i> Share
                    </button>
                </div>
            {% else %}
                <div class="stock-status out-of-stock">
                    <div class="stock-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="stock-details">
                        <h4>Out of Stock</h4>
                        <p>This item is currently unavailable</p>
                    </div>
                </div>
                
                <!-- Notify Button -->
                <button class="add-to-cart-btn" onclick="notifyWhenAvailable()" style="background: var(--bg-secondary); color: var(--text-primary);">
                    <i class="fas fa-bell"></i>
                    Notify When Available
                </button>
            {% endif %}
            
            <!-- Delivery Information -->
            <div class="delivery-info">
                <div class="delivery-item">
                    <i class="fas fa-truck"></i>
                    <span>Free Delivery</span>
                    <small>On all orders in MMU</small>
                </div>
                <div class="delivery-item">
                    <i class="fas fa-undo-alt"></i>
                    <span>Easy Returns</span>
                    <small>3-day return policy</small>
                </div>
                <div class="delivery-item">
                    <i class="fas fa-shield-alt"></i>
                    <span>Secure Payment</span>
                    <small>100% secure</small>
                </div>
            </div>
            
            <!-- Additional Product Info -->
            <div class="product-tabs">
                <div class="tab-headers">
                    <div class="tab-header active" onclick="switchTab(0)">Details</div>
                    <div class="tab-header" onclick="switchTab(1)">Shipping</div>
                    <div class="tab-header" onclick="switchTab(2)">Reviews</div>
                </div>
                <div class="tab-content" id="tabContent">
                    <p><strong>Stock Type:</strong> {{ product.get_stock_type_display }}</p>
                    <p><strong>Delivery:</strong> {{ product.get_delivery_type }}</p>
                    <p><strong>Material:</strong> Premium Quality Fabric</p>
                    <p><strong>Care Instructions:</strong> Machine wash cold, tumble dry low</p>
                </div>
            </div>
            
            <a href="{% url 'home' %}" class="back-link">
                <i class="fas fa-arrow-left"></i>
                Back to Products
            </a>
        </div>
    </div>
    
    <!-- RECOMMENDATIONS SECTION -->
    {% if recommended_products %}
    <div class="recommendations-section">
        <div class="section-header">
            <h3>You May Also Like</h3>
            <p>More {{ product.get_category_display }} for you</p>
        </div>
        
        <div class="recommendations-grid">
            {% for rec_product in recommended_products %}
                <a href="{% url 'product_detail' rec_product.id %}" class="recommendation-card">
                    {% if rec_product.image %}
                        <img src="{{ rec_product.image.url }}" alt="{{ rec_product.name }}" class="recommendation-image">
                    {% else %}
                        <div class="recommendation-image-placeholder">
                            <i class="fas fa-image"></i>
                        </div>
                    {% endif %}
                    <h4>{{ rec_product.name|truncatechars:30 }}</h4>
                    <div class="recommendation-price">KSh {{ rec_product.price|floatformat:0 }}</div>
                    <div class="recommendation-stock">
                        <i class="fas {% if rec_product.is_in_stock %}fa-check-circle{% else %}fa-times-circle{% endif %}"></i>
                        {{ rec_product.stock_quantity }} in stock
                    </div>
                </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<script>
// Image gallery functionality
function changeImage(imageUrl, thumbnailElement) {
    const mainImage = document.getElementById('mainImage');
    if (mainImage) {
        mainImage.style.opacity = '0';
        setTimeout(() => {
            mainImage.src = imageUrl;
            mainImage.style.opacity = '1';
        }, 150);
    }
    
    // Update active thumbnail
    document.querySelectorAll('.thumbnail-item').forEach(thumb => {
        thumb.classList.remove('active');
    });
    thumbnailElement.classList.add('active');
}

// Quantity controls
function incrementQuantity(max) {
    const input = document.getElementById('quantity');
    let value = parseInt(input.value);
    if (value < max) {
        input.value = value + 1;
    }
}

function decrementQuantity() {
    const input = document.getElementById('quantity');
    let value = parseInt(input.value);
    if (value > 1) {
        input.value = value - 1;
    }
}

// Tab switching
function switchTab(tabIndex) {
    const tabs = document.querySelectorAll('.tab-header');
    const tabContent = document.getElementById('tabContent');
    
    tabs.forEach((tab, index) => {
        if (index === tabIndex) {
            tab.classList.add('active');
        } else {
            tab.classList.remove('active');
        }
    });
    
    const contents = [
        `<p><strong>Stock Type:</strong> {{ product.get_stock_type_display|escapejs }}</p>
         <p><strong>Delivery:</strong> {{ product.get_delivery_type|escapejs }}</p>
         <p><strong>Material:</strong> Premium Quality Fabric</p>
         <p><strong>Care Instructions:</strong> Machine wash cold, tumble dry low</p>`,
        
        `<p><strong>Shipping Information:</strong></p>
         <ul style="margin-left: 1.5rem;">
             <li>Free shipping on orders in MMU</li>
             <li>Standard delivery: 3-5 business days</li>
             <li>Express delivery: 1-2 business days</li>
             <li>Same-day delivery available in MMU Rongai</li>
         </ul>`,
        
        `<p><strong>Customer Reviews</strong></p>
         <p>No reviews yet. Be the first to review this product!</p>`
    ];
    
    tabContent.innerHTML = contents[tabIndex];
}

// Add to cart handling
document.addEventListener('DOMContentLoaded', function() {
    const addToCartForm = document.getElementById('addToCartForm');
    if (addToCartForm) {
        addToCartForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('addToCartBtn');
            const originalHTML = btn.innerHTML;
            
            // Show loading state
            btn.innerHTML = '<span class="spinner"></span> Adding...';
            btn.disabled = true;
            
            // Simulate API call (replace with actual form submission)
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-check"></i> Added!';
                btn.style.background = '#10B981';
                
                // Show toast notification
                showToast('Item added to cart successfully!');
                
                // Reset button after 2 seconds
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                    btn.style.background = '';
                }, 2000);
                
                // Submit form after visual feedback
                setTimeout(() => {
                    addToCartForm.submit();
                }, 500);
            }, 800);
        });
    }
    
    // Size select enhancement
    const sizeSelect = document.getElementById('size');
    if (sizeSelect) {
        sizeSelect.addEventListener('change', function() {
            this.style.borderColor = 'var(--primary)';
        });
    }
});

// Toast notification
function showToast(message, type = 'success') {
    // Remove any existing toast
    const existingToast = document.querySelector('.toast-notification');
    if (existingToast) {
        existingToast.remove();
    }
    
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.innerHTML = `
        <div class="toast-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="toast-message">${message}</div>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => {
            if (toast.parentNode) {
                document.body.removeChild(toast);
            }
        }, 300);
    }, 3000);
}

// Wishlist function
function addToWishlist(productId) {
    const btn = event.currentTarget;
    const originalHTML = btn.innerHTML;
    
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
    btn.disabled = true;
    
    // Simulate API call
    setTimeout(() => {
        btn.innerHTML = '<i class="fas fa-heart" style="color: #FF6B9D;"></i> Added to Wishlist';
        setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.disabled = false;
        }, 2000);
        showToast('Added to wishlist!');
    }, 500);
}

// Share function
function shareProduct() {
    if (navigator.share) {
        navigator.share({
            title: '{{ product.name|escapejs }}',
            text: '{{ product.description|truncatechars:100|escapejs }}',
            url: window.location.href
        }).catch(console.error);
    } else {
        // Fallback
        navigator.clipboard.writeText(window.location.href).then(() => {
            showToast('Link copied to clipboard!');
        }).catch(() => {
            showToast('Press Ctrl+C to copy the link');
        });
    }
}

// Notify when available
function notifyWhenAvailable() {
    const btn = event.currentTarget;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Subscribing...';
    btn.disabled = true;
    
    setTimeout(() => {
        btn.innerHTML = '<i class="fas fa-check"></i> Subscribed!';
        setTimeout(() => {
            btn.innerHTML = '<i class="fas fa-bell"></i> Notify When Available';
            btn.disabled = false;
        }, 2000);
        showToast('We\'ll notify you when this item is back in stock!');
    }, 800);
}

// Zoom modal (optional enhancement)
function openZoomModal() {
    // You can implement a modal zoom feature here
    console.log('Zoom image');
}
</script>
{% endblock %}
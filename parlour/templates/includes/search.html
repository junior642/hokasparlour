<!-- Search Bar Component with Live JavaScript Search - Sticky Version -->
<style>
    /* Search bar wrapper with theme-matching background */
    .search-bar-sticky-wrapper {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: var(--bg); /* Changed to use theme background directly */
        border-bottom: 1px solid var(--border);
        padding: 1rem 0;
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        width: 100%;
    }

    /* Add slight shadow when scrolled - using theme accent */
    .search-bar-sticky-wrapper.scrolled {
        box-shadow: 0 4px 20px rgba(var(--accent-rgb), 0.15);
        border-bottom-color: var(--accent-light);
    }

    /* Container for content alignment */
    .search-bar-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1.5rem;
        width: 100%;
    }

    /* Enhanced search input */
    .filter-group {
        margin: 0;
    }

    .filter-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text);
        letter-spacing: 0.3px;
    }

    .relative {
        position: relative;
    }

    #liveSearch {
        width: 100%;
        padding: 0.875rem 3rem 0.875rem 3rem;
        border: 2px solid var(--border);
        border-radius: 16px;
        background: var(--surface); /* Changed to use surface color for contrast */
        color: var(--text);
        font-size: 0.95rem;
        transition: all 0.3s ease;
        outline: none;
        box-shadow: var(--shadow-sm);
    }

    #liveSearch:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 4px var(--accent-soft);
        transform: translateY(-1px);
    }

    #liveSearch::placeholder {
        color: var(--text-soft);
        font-style: italic;
        opacity: 0.7;
    }

    /* Animated search icon */
    .absolute.left-3 {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--accent);
        transition: all 0.3s ease;
        font-size: 1rem;
    }

    #liveSearch:focus ~ .absolute.left-3 {
        color: var(--accent-light);
        transform: translateY(-50%) scale(1.1);
    }

    /* Action buttons container */
    .search-actions {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Loading spinner animation */
    #searchSpinner i {
        animation: spin 0.8s linear infinite;
        color: var(--accent);
        font-size: 1.1rem;
    }

    /* Clear button */
    #clearSearch {
        background: transparent;
        border: none;
        color: var(--text-soft);
        cursor: pointer;
        transition: all 0.2s ease;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    #clearSearch:hover {
        color: var(--accent);
        transform: scale(1.1);
    }

    /* Search results count */
    #searchResultsCount {
        margin-top: 0.75rem;
        font-size: 0.85rem;
        color: var(--text-soft);
        padding-left: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    #resultsCount {
        background: var(--accent-soft);
        color: var(--accent);
        padding: 0.2rem 0.6rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.75rem;
    }

    /* Active search indicator with animation */
    #activeSearchIndicator {
        margin-top: 0.75rem;
        animation: slideDown 0.3s ease;
    }

    #activeSearchIndicator > div {
        background: var(--accent-soft);
        border: 1px solid var(--accent-light);
        border-radius: 50px;
        padding: 0.6rem 1.2rem;
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        box-shadow: 0 4px 12px rgba(var(--accent-rgb), 0.15);
    }

    #activeSearchIndicator i {
        color: var(--accent);
    }

    #activeSearchIndicator span {
        color: var(--accent);
        font-weight: 600;
    }

    #searchTerm {
        font-style: italic;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* No results message */
    #noResultsMessage {
        animation: fadeIn 0.4s ease;
        padding: 3rem 2rem;
        text-align: center;
        background: var(--card);
        border-radius: 24px;
        border: 1px solid var(--border);
        margin-top: 1.5rem;
    }

    #noResultsMessage i {
        font-size: 3.5rem;
        color: var(--accent-light);
        margin-bottom: 1rem;
    }

    #noResultsMessage h3 {
        color: var(--text);
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
    }

    #noResultsMessage p {
        color: var(--text-soft);
        margin-bottom: 1.5rem;
    }

    #noResultsMessage button {
        background: var(--accent);
        color: white;
        border: none;
        padding: 0.75rem 2rem;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    #noResultsMessage button:hover {
        background: var(--accent-light);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(var(--accent-rgb), 0.3);
    }

    /* Animations */
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* Product card transitions */
    .product-card {
        transition: opacity 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card.search-highlight {
        animation: highlightPulse 1s ease;
    }

    @keyframes highlightPulse {
        0% { transform: scale(1); box-shadow: 0 0 0 0 var(--accent-light); }
        50% { transform: scale(1.02); box-shadow: 0 0 20px var(--accent-light); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 var(--accent-light); }
    }

    /* Hidden utility */
    .hidden {
        display: none !important;
    }

    /* Dark mode specific adjustments */
    .dark-mode .search-bar-sticky-wrapper {
        background: var(--bg); /* Uses dark mode background automatically */
        border-bottom-color: var(--border);
    }

    .dark-mode #liveSearch {
        background: var(--surface);
        border-color: var(--border);
        color: var(--text);
    }

    .dark-mode #liveSearch:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 4px rgba(var(--accent-rgb), 0.2);
    }

    .dark-mode #noResultsMessage {
        background: var(--card);
        border-color: var(--border);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .search-bar-sticky-wrapper {
            padding: 0.75rem 0;
        }
        
        .search-bar-container {
            padding: 0 1rem;
        }
        
        #liveSearch {
            padding: 0.75rem 2.5rem 0.75rem 2.5rem;
            font-size: 0.9rem;
        }
        
        .absolute.left-3 {
            left: 0.75rem;
            font-size: 0.9rem;
        }
        
        .search-actions {
            right: 0.75rem;
        }
        
        #activeSearchIndicator > div {
            width: 100%;
            justify-content: center;
        }
        
        #searchTerm {
            max-width: 150px;
        }
    }

    @media (max-width: 480px) {
        .search-bar-sticky-wrapper {
            padding: 0.5rem 0;
        }
        
        .search-bar-container {
            padding: 0 0.75rem;
        }
        
        #liveSearch {
            padding: 0.7rem 2rem 0.7rem 2.2rem;
            font-size: 0.85rem;
        }
        
        .absolute.left-3 {
            left: 0.6rem;
            font-size: 0.8rem;
        }
        
        .search-actions {
            right: 0.6rem;
        }
        
        #searchTerm {
            max-width: 120px;
        }
    }
</style>

<!-- Search Bar HTML with Sticky Wrapper -->
<div class="search-bar-sticky-wrapper" id="stickySearchBar">
    <div class="search-bar-container">
        <div class="filter-group">
            <div class="relative">
                <input type="text" 
                       id="liveSearch"
                       placeholder="Type to search products by name, category, description..." 
                       autocomplete="off">
                
                <i class="fas fa-search absolute left-3"></i>
                
                <div class="search-actions">
                    <!-- Loading spinner (hidden by default) -->
                    <div id="searchSpinner" class="hidden">
                        <i class="fas fa-spinner"></i>
                    </div>
                    
                    <!-- Clear search button -->
                    <button id="clearSearch" 
                            class="hidden"
                            onclick="clearSearch()"
                            type="button">
                        <i class="fas fa-times-circle"></i>
                    </button>
                </div>
            </div>
            
            <!-- Search results count -->
            <div id="searchResultsCount" class="hidden">
                Found <span id="resultsCount">0</span> products
            </div>
        </div>

        <!-- Active search indicator -->
        <div id="activeSearchIndicator" class="hidden">
            <div>
                <i class="fas fa-search"></i>
                <span>Searching: "<span id="searchTerm"></span>"</span>
                <button onclick="clearSearch()" type="button" class="hover:scale-110 transition-transform">
                    <i class="fas fa-times-circle"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- No results message (separate from sticky bar) -->
<div id="noResultsMessage" class="hidden">
    <i class="fas fa-search"></i>
    <h3>No products found</h3>
    <p>No products match your search "<span id="noResultsTerm"></span>"</p>
    <button onclick="clearSearch()" type="button">
        <i class="fas fa-undo-alt"></i> Clear Search
    </button>
</div>

<script>
// Live search functionality
document.addEventListener('DOMContentLoaded', function() {
    // Add scroll effect to sticky bar
    const stickyBar = document.getElementById('stickySearchBar');
    
    function handleScroll() {
        if (window.scrollY > 10) {
            stickyBar.classList.add('scrolled');
        } else {
            stickyBar.classList.remove('scrolled');
        }
    }
    
    window.addEventListener('scroll', handleScroll);
    
    const searchInput = document.getElementById('liveSearch');
    const searchSpinner = document.getElementById('searchSpinner');
    const clearButton = document.getElementById('clearSearch');
    const searchResultsCount = document.getElementById('searchResultsCount');
    const resultsCountSpan = document.getElementById('resultsCount');
    const activeSearchIndicator = document.getElementById('activeSearchIndicator');
    const searchTermSpan = document.getElementById('searchTerm');
    const noResultsMessage = document.getElementById('noResultsMessage');
    const noResultsTerm = document.getElementById('noResultsTerm');
    const productGrid = document.querySelector('.products-grid');
    
    // Store original products HTML
    let originalProductsHTML = '';
    if (productGrid) {
        originalProductsHTML = productGrid.innerHTML;
    }
    
    // Get all product cards data for searching
    const productCards = [];
    document.querySelectorAll('.product-card').forEach((card, index) => {
        // Store card data with a unique identifier
        productCards.push({
            id: index,
            element: card,
            name: card.querySelector('h3')?.textContent.toLowerCase() || '',
            description: card.querySelector('p')?.textContent.toLowerCase() || '',
            category: card.querySelector('.product-category')?.textContent.toLowerCase() || '',
            price: card.querySelector('.product-price')?.textContent.toLowerCase() || '',
            html: card.outerHTML
        });
    });
    
    let searchTimeout;
    
    // Live search function
    function performSearch(query) {
        query = query.toLowerCase().trim();
        
        // Show/hide clear button
        if (query.length > 0) {
            clearButton.classList.remove('hidden');
        } else {
            clearButton.classList.add('hidden');
        }
        
        // Update active search indicator
        if (query.length > 0) {
            searchTermSpan.textContent = query;
            activeSearchIndicator.classList.remove('hidden');
        } else {
            activeSearchIndicator.classList.add('hidden');
        }
        
        // Filter products
        const filteredProducts = productCards.filter(card => {
            return card.name.includes(query) || 
                   card.description.includes(query) || 
                   card.category.includes(query) ||
                   card.price.includes(query);
        });
        
        // Update results count
        if (query.length > 0) {
            resultsCountSpan.textContent = filteredProducts.length;
            searchResultsCount.classList.remove('hidden');
        } else {
            searchResultsCount.classList.add('hidden');
        }
        
        // Update product grid
        if (productGrid) {
            if (filteredProducts.length === 0 && query.length > 0) {
                // Show no results message
                noResultsTerm.textContent = query;
                noResultsMessage.classList.remove('hidden');
                productGrid.innerHTML = ''; // Clear grid
            } else {
                // Hide no results message
                noResultsMessage.classList.add('hidden');
                
                // Rebuild grid with filtered products
                if (filteredProducts.length > 0) {
                    productGrid.innerHTML = filteredProducts.map(card => card.html).join('');
                    
                    // Add highlight animation to first result
                    setTimeout(() => {
                        const firstResult = productGrid.querySelector('.product-card');
                        if (firstResult) {
                            firstResult.classList.add('search-highlight');
                            setTimeout(() => {
                                firstResult.classList.remove('search-highlight');
                            }, 1000);
                        }
                    }, 100);
                } 
                
                // If search is empty, restore original products
                if (query.length === 0) {
                    productGrid.innerHTML = originalProductsHTML;
                }
            }
        }
    }
    
    // Input event listener with debounce
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const query = e.target.value;
            
            // Show loading spinner
            searchSpinner.classList.remove('hidden');
            
            // Clear previous timeout
            clearTimeout(searchTimeout);
            
            // Set new timeout for debounce (300ms)
            searchTimeout = setTimeout(() => {
                performSearch(query);
                searchSpinner.classList.add('hidden');
            }, 300);
        });
    }
    
    // Clear search function
    window.clearSearch = function() {
        if (searchInput) {
            searchInput.value = '';
            searchInput.focus();
            searchSpinner.classList.add('hidden');
            clearButton.classList.add('hidden');
            activeSearchIndicator.classList.add('hidden');
            searchResultsCount.classList.add('hidden');
            noResultsMessage.classList.add('hidden');
            
            // Restore original products
            if (productGrid) {
                productGrid.innerHTML = originalProductsHTML;
            }
            
            // Remove sticky bar scroll effect
            stickyBar.classList.remove('scrolled');
        }
    };
    
    // Handle keyboard shortcut (Escape to clear)
    if (searchInput) {
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                e.preventDefault();
                clearSearch();
            }
        });
    }
    
    // Prevent form submission on enter
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                // Optionally trigger search immediately
                performSearch(e.target.value);
            }
        });
    }

    // Clean up scroll listener on page unload
    window.addEventListener('beforeunload', function() {
        window.removeEventListener('scroll', handleScroll);
    });
});

// Add RGB variable for accent color if not exists
if (!document.querySelector('style#accent-rgb')) {
    const style = document.createElement('style');
    style.id = 'accent-rgb';
    style.textContent = `
        :root {
            --accent-rgb: 123, 46, 218; /* Your accent color in RGB */
        }
        
        .dark-mode {
            --accent-rgb: 178, 135, 253; /* Lighter accent for dark mode */
        }
    `;
    document.head.appendChild(style);
}
</script>